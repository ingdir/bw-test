define("cloud/cloudCtrl",[],function(){function t(t,e){t.forEach(function(t){t.popularity=t[e]})}function e(t,e,n,r){var a=r-n;t.forEach(function(t){t.fontWeight=Math.floor((e-1)*(t.popularity-n)/a),t.modifier=t.sentimentScore>60?"high":t.sentimentScore<40?"low":""})}function n(t){var e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return t.forEach(function(t){t.popularity>=n&&(n=t.popularity),t.popularity<=e&&(e=t.popularity)}),{min:e,max:n}}function r(t){t.sort(function(t,e){return t.popularity>e.popularity?-1:t.popularity<e.popularity?1:0})}function a(a,i){var o=$.extend(!0,[],a||[]);t(o,i);var u=n(o);return e(o,6,u.min,u.max),r(o),o}return{getMinMax:n,assignVisualData:e,sortByPopularity:r,calcPopularity:t,getData:a}}),function(){function t(t){return Function("data,subst",r(n(t)))}var e={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11},n=function(){function t(t){M=t.split(""),$=0,D=null,H=M.length;var e=n(),r=R();return r.type!==W.EOP&&k(r),e}function n(){for(var t,n=r();E("|");)R(),(t||(t=[n])).push(r());return t?{type:e.CONCAT_EXPR,args:t}:n}function r(){return E("(")?a():o()}function a(){C("(");var t=n();C(")");for(var r,a=[];r=i();)a.push(r);return a.length?t.type===e.PATH?(t.parts=t.parts.concat(a),t):(a.unshift(t),{type:e.PATH,parts:a}):t}function i(){return E("[")?l():E("{")?f():E("(")?a():void 0}function o(){O()||k(R());var t,n=!1;E("^")?(R(),n=!0):T()&&(t=R().val.substr(1));for(var r,a=[];r=u();)a.push(r);return{type:e.PATH,fromRoot:n,subst:t,parts:a}}function u(){return m()?s():i()}function s(){var t,n=R().val,r=A();return(E("*")||r.type===W.ID||r.type===W.STR)&&(t=R().val),{type:e.SELECTOR,selector:n,prop:t}}function l(){C("[");var t=y();return C("]"),{type:e.POS_PRED,arg:t}}function f(){C("{");var t=c();return C("}"),{type:e.OBJ_PRED,arg:t}}function c(){for(var t,n=p();E("||");)R(),(t||(t=[n])).push(p());return t?{type:e.LOGICAL_EXPR,op:"||",args:t}:n}function p(){for(var t,n=d();E("&&");)R(),(t||(t=[n])).push(d());return t?{type:e.LOGICAL_EXPR,op:"&&",args:t}:n}function d(){for(var t=h();E("==")||E("!=")||E("===")||E("!==")||E("^=")||E("^==")||E("$==")||E("$=")||E("*==")||E("*=");)t={type:e.COMPARISON_EXPR,op:R().val,args:[t,d()]};return t}function h(){for(var t=v();E("<")||E(">")||E("<=")||E(">=");)t={type:e.COMPARISON_EXPR,op:R().val,args:[t,h()]};return t}function v(){for(var t=g();E("+")||E("-");)t={type:e.MATH_EXPR,op:R().val,args:[t,v()]};return t}function g(){for(var t=b();E("*")||E("/")||E("%");)t={type:e.MATH_EXPR,op:R().val,args:[t,g()]};return t}function y(){if(E(":"))return R(),{type:e.POS_EXPR,toIdx:b()};var t=b();return E(":")?(R(),E("]")?{type:e.POS_EXPR,fromIdx:t}:{type:e.POS_EXPR,fromIdx:t,toIdx:b()}):{type:e.POS_EXPR,idx:t}}function b(){return E("!")||E("-")?{type:e.UNARY_EXPR,op:R().val,arg:b()}:P()}function P(){var t=A(),n=t.type;return n===W.STR||n===W.NUM||n===W.BOOL?{type:e.LITERAL,val:R().val}:O()?o():E("(")?_():k(R())}function _(){C("(");var t=c();return C(")"),t}function E(t){var e=A();return e.type===W.PUNCT&&e.val===t}function O(){return m()||T()||E("^")}function m(){var t=A();if(t.type===W.PUNCT){var e=t.val;return"."===e||".."===e}return!1}function T(){var t=A();return t.type===W.ID&&"$"===t.val[0]}function C(t){var e=R();(e.type!==W.PUNCT||e.val!==t)&&k(e)}function A(){if(null!==D)return D;var t=$;return D=x(),$=t,D}function x(){for(;I(M[$]);)++$;if($>=H)return{type:W.EOP,range:[$,$]};var t=X();return t||(t=j())||(t=L())||(t=U())?t:(t={range:[$,$]},$>=H?t.type=W.EOP:t.val=M[$],void k(t))}function R(){var t;return D?($=D.range[1],t=D,D=null,t):x()}function w(t){return"0123456789".indexOf(t)>=0}function I(t){return" "===t}function S(t){return"$"===t||"_"===t||t>="a"&&"z">=t||t>="A"&&"Z">=t}function N(t){return S(t)||t>="0"&&"9">=t}function j(){var t=M[$];if(S(t)){for(var e=$,n=t;++$<H&&(t=M[$],N(t));)n+=t;return"true"===n||"false"===n?{type:W.BOOL,val:"true"===n,range:[e,$]}:{type:W.ID,val:n,range:[e,$]}}}function L(){if('"'===M[$]){for(var t,e=++$,n="",r=!1;H>$;){if(t=M[$++],"\\"===t)t=M[$++];else if('"'===t){r=!0;break}n+=t}return r?{type:W.STR,val:n,range:[e,$]}:void 0}}function U(){var t=$,e=M[$],n="."===e;if(n||w(e)){for(var r=e;++$<H;){if(e=M[$],"."===e){if(n)return;n=!0}else if(!w(e))break;r+=e}return{type:W.NUM,val:n?parseFloat(r):parseInt(r,10),range:[t,$]}}}function X(){var t=$,e=M[$],n=M[$+1];if("."===e){if(w(n))return;return"."===M[++$]?{type:W.PUNCT,val:"..",range:[t,++$]}:{type:W.PUNCT,val:".",range:[t,$]}}if("="===n){var r=M[$+2];if("="===r){if("=!^$*".indexOf(e)>=0)return{type:W.PUNCT,val:e+n+r,range:[t,$+=3]}}else if("=!^$*><".indexOf(e)>=0)return{type:W.PUNCT,val:e+n,range:[t,$+=2]}}return e!==n||"|"!==e&&"&"!==e?":{}()[]^+-*/%!><|".indexOf(e)>=0?{type:W.PUNCT,val:e,range:[t,++$]}:void 0:{type:W.PUNCT,val:e+n,range:[t,$+=2]}}function k(t){t.type===W.EOP&&q(t,B.UNEXP_EOP),q(t,B.UNEXP_TOKEN,t.val)}function q(t,e){var n=Array.prototype.slice.call(arguments,2),r=e.replace(/%(\d)/g,function(t,e){return n[e]||""}),a=new Error(r);throw a.column=t.range[0],a}var M,$,D,H,W={ID:1,NUM:2,STR:3,BOOL:4,PUNCT:5,EOP:6},B={UNEXP_TOKEN:'Unexpected token "%0"',UNEXP_EOP:"Unexpected end of path"};return t}(),r=function(){function t(){if(T.length)return T.shift();var t="v"+ ++m;return O.push(t),t}function n(){for(var t=arguments,e=t.length;e--;)T.push(t[e])}function r(t){if(E=[],O=["res"],m=0,T=[],l(t,"res","data"),E.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',",",O.join(","),";"),t.type===e.PATH){var n=t.parts[t.parts.length-1];n&&n.type===e.POS_PRED&&"idx"in n.arg&&E.push("res = res[0];")}return E.push("return res;"),E.join("")}function a(t,n,r){var a=t.parts,l=0,f=a.length;for(E.push(n,"=",t.fromRoot?"data":t.subst?"subst."+t.subst:r,";","isArr("+n+") || ("+n+" = ["+n+"]);");f>l;){var c=a[l++];switch(c.type){case e.SELECTOR:".."===c.selector?o(c,n,n):i(c,n,n);break;case e.OBJ_PRED:u(c,n,n);break;case e.POS_PRED:s(c,n,n);break;case e.CONCAT_EXPR:v(c,n,n)}}}function i(e,r,a){if(e.prop){var i=g(e.prop),o=t(),u=t(),s=t(),l=t(),f=t(),c=t(),p=t();E.push(o,"= [];",u,"= 0;",s,"=",a,".length;",p,"= [];","while(",u,"<",s,") {",l,"=",a,"[",u,"++];","if(",l,"!= null) {"),"*"===e.prop?(E.push("if(typeof ",l,'=== "object") {',"if(isArr(",l,")) {",o,"=",o,".concat(",l,");","}","else {","for(",f," in ",l,") {","if(",l,".hasOwnProperty(",f,")) {",c,"=",l,"[",f,"];"),y(o,c),E.push("}","}","}","}")):(E.push(c,"=",l,"[",i,"];"),y(o,c,p,s)),E.push("}","}",r,"=",s,"> 1 &&",p,".length?",p,".length > 1?",o,".concat.apply(",o,",",p,") :",o,".concat(",p,"[0]) :",o,";"),n(o,u,s,l,f,c,p)}}function o(e,r,a){var i=e.prop,o=t(),u=t(),s=t(),l=t(),f=t(),c=t(),p=t(),d=t();E.push(o,"=",a,".slice(),",d,"= [];","while(",o,".length) {",u,"=",o,".shift();"),i?E.push("if(typeof ",u,'=== "object" &&',u,") {"):E.push("if(typeof ",u,"!= null) {"),E.push(s,"= [];","if(isArr(",u,")) {",l,"= 0,",p,"=",u,".length;","while(",l,"<",p,") {",c,"=",u,"[",l,"++];"),i&&E.push("if(typeof ",c,'=== "object") {'),y(s,c),i&&E.push("}"),E.push("}","}","else {"),i?"*"!==i&&(E.push(c,"=",u,'["'+i+'"];'),y(d,c)):(y(d,u),E.push("if(typeof ",u,'=== "object") {')),E.push("for(",f," in ",u,") {","if(",u,".hasOwnProperty(",f,")) {",c,"=",u,"[",f,"];"),y(s,c),"*"===i&&y(d,c),E.push("}","}"),i||E.push("}"),E.push("}",s,".length &&",o,".unshift.apply(",o,",",s,");","}","}",r,"=",d,";"),n(o,u,s,l,f,c,p,d)}function u(e,r,a){var i=t(),o=t(),u=t(),s=t(),f=t();E.push(i,"= [];",o,"= 0;",u,"=",a,".length;","while(",o,"<",u,") {",f,"=",a,"[",o,"++];"),l(e.arg,s,f),E.push(P(e.arg,s),"&&",i,".push(",f,");","}",r,"=",i,";"),n(i,o,u,f,s)}function s(e,r,a){var i,o,u=e.arg;if(u.idx){var s=t();return l(u.idx,s,a),E.push(s,"< 0 && (",s,"=",a,".length +",s,");",r,"=",a,"[",s,"] == null? [] : [",a,"[",s,"]];"),n(s),!1}u.fromIdx?u.toIdx?(l(u.fromIdx,i=t(),a),l(u.toIdx,o=t(),a),E.push(r,"=",a,".slice(",i,",",o,");"),n(i,o)):(l(u.fromIdx,i=t(),a),E.push(r,"=",a,".slice(",i,");"),n(i)):(l(u.toIdx,o=t(),a),E.push(r,"=",a,".slice(0,",o,");"),n(o))}function l(t,n,r){switch(t.type){case e.PATH:a(t,n,r);break;case e.CONCAT_EXPR:v(t,n,r);break;case e.COMPARISON_EXPR:f(t,n,r);break;case e.MATH_EXPR:d(t,n,r);break;case e.LOGICAL_EXPR:p(t,n,r);break;case e.UNARY_EXPR:h(t,n,r);break;case e.LITERAL:var i=t.val;E.push(n,"=","string"==typeof i?g(i):i,";")}}function f(r,a,i){var o=t(),u=t(),s=t(),f=t(),p=t(),d=t(),h=t(),v=t(),g=r.args[0],y=r.args[1];E.push(a,"= false;"),l(g,o,i),l(y,u,i);var b=g.type===e.PATH,P=y.type===e.LITERAL;E.push(s,"="),b?E.push("true;"):E.push("isArr(",o,");"),E.push(f,"="),P?E.push("false;"):E.push("isArr(",u,");"),E.push("if("),b||E.push(s,"&&"),E.push(o,".length === 1) {",o,"=",o,"[0];",s,"= false;","}"),P||E.push("if(",f,"&&",u,".length === 1) {",u,"=",u,"[0];",f,"= false;","}"),E.push(p,"= 0;","if(",s,") {",h,"=",o,".length;"),P||(E.push("if(",f,") {",v,"=",u,".length;","while(",p,"<",h,"&& !",a,") {",d,"= 0;","while(",d,"<",v,") {"),c(r.op,[o,"[",p,"]"].join(""),[u,"[",d,"]"].join("")),E.push(a,"= true;","break;","}","++",d,";","}","++",p,";","}","}","else {")),E.push("while(",p,"<",h,") {"),c(r.op,[o,"[",p,"]"].join(""),u),E.push(a,"= true;","break;","}","++",p,";","}"),P||E.push("}"),E.push("}"),P||(E.push("else if(",f,") {",v,"=",u,".length;","while(",p,"<",v,") {"),c(r.op,o,[u,"[",p,"]"].join("")),E.push(a,"= true;","break;","}","++",p,";","}","}")),E.push("else {",a,"=",C[r.op](o,u),";","}"),n(o,u,s,f,p,d,h,v)}function c(t,e,n){E.push("if(",C[t](e,n),") {")}function p(e,r,a){var i,o=[],u=e.args,s=u.length,f=0;switch(E.push(r,"= false;"),e.op){case"&&":for(;s>f;)o.push(i=t()),l(u[f],i,a),E.push("if(",P(u[f++],i),") {");E.push(r,"= true;");break;case"||":for(;s>f;)o.push(i=t()),l(u[f],i,a),E.push("if(",P(u[f],i),") {",r,"= true;","}"),f++ +1<s&&E.push("else {");--s}for(;s--;)E.push("}");n.apply(null,o)}function d(e,r,a){var i=t(),o=t(),u=e.args;l(u[0],i,a),l(u[1],o,a),E.push(r,"=",C[e.op](_(u[0],i),_(u[1],o)),";"),n(i,o)}function h(e,r,a){var i=t(),o=e.arg;switch(l(o,i,a),e.op){case"!":E.push(r,"= !",P(o,i)+";");break;case"-":E.push(r,"= -",_(o,i)+";")}n(i)}function v(e,r,a){for(var i=[],o=e.args,u=o.length,s=0;u>s;)i.push(t()),l(o[s],i[s++],a);E.push(r,"= (",r,"= []).concat.call(",r,",",i.join(","),");"),n.apply(null,i)}function g(t){return"'"+t.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function y(t,e,n,r){E.push("if(",e,"!= null) {","if(isArr(",e,")) {"),n&&(E.push(r,"> 1?"),b(n,e),E.push(":")),E.push(t,"=",t,".length? ",t,".concat(",e,") : ",e,";","}","else {"),n&&E.push("if(",n,".length) {",t,"=",t,".concat.apply(",t,",",n,");",n,"= [];","}"),b(t,e),E.push(";","}","}")}function b(t,e){E.push(t,".length?",t,".push(",e,") :",t,"[0] =",e)}function P(t,n){switch(t.type){case e.LOGICAL_EXPR:return n;case e.LITERAL:return"!!"+n;case e.PATH:return n+".length > 0";default:return["(typeof ",n,'=== "boolean"?',n,":","isArr(",n,")?",n,".length > 0 : !!",n,")"].join("")}}function _(t,n){switch(t.type){case e.LITERAL:return n;case e.PATH:return n+"[0]";default:return["(isArr(",n,")?",n,"[0] : ",n,")"].join("")}}var E,O,m,T,C={"===":function(t,e){return t+"==="+e},"==":function(t,e){return["typeof ",t,'=== "string" && typeof ',e,'=== "string"?',t,".toLowerCase() ===",e,".toLowerCase() :"+t,"==",e].join("")},">=":function(t,e){return t+">="+e},">":function(t,e){return t+">"+e},"<=":function(t,e){return t+"<="+e},"<":function(t,e){return t+"<"+e},"!==":function(t,e){return t+"!=="+e},"!=":function(t,e){return t+"!="+e},"^==":function(t,e){return["typeof ",t,'=== "string" && typeof ',e,'=== "string" &&',t,".indexOf(",e,") === 0"].join("")},"^=":function(t,e){return[t,"!= null &&",e,"!= null &&",t,".toString().toLowerCase().indexOf(",e,".toString().toLowerCase()) === 0"].join("")},"$==":function(t,e){return["typeof ",t,'=== "string" && typeof ',e,'=== "string" &&',t,".lastIndexOf(",e,") ===",t,".length -",e,".length"].join("")},"$=":function(t,e){return[t,"!= null &&",e,"!= null &&","(",t,"=",t,".toLowerCase().toString()).indexOf(","(",e,"=",e,".toLowerCase().toLowerCase())) ===",t,".length -",e,".length"].join("")},"*==":function(t,e){return["typeof ",t,'=== "string" && typeof ',e,'=== "string" &&',t,".indexOf(",e,") > -1"].join("")},"*=":function(t,e){return[t,"!= null && ",e,"!= null &&",t,".toString().toLowerCase().indexOf(",e,".toString().toLowerCase()) > -1"].join("")},"+":function(t,e){return t+"+"+e},"-":function(t,e){return t+"-"+e},"*":function(t,e){return t+"*"+e},"/":function(t,e){return t+"/"+e},"%":function(t,e){return t+"%"+e}};return r}(),a={},i=[],o={cacheSize:100},u={cacheSize:function(t,e){if(t>e&&i.length>e)for(var n=i.splice(0,i.length-e),r=n.length;r--;)delete a[n[r]]}},s=function(e,n,r){return a[e]||(a[e]=t(e),i.push(e)>o.cacheSize&&delete a[i.shift()]),a[e](n,r||{})};s.version="0.3.0",s.params=function(t){if(!arguments.length)return o;for(var e in t)t.hasOwnProperty(e)&&(u[e]&&u[e](o[e],t[e]),o[e]=t[e])},s.compile=t,s.apply=s,"object"==typeof module&&"object"==typeof module.exports?module.exports=s:"object"==typeof modules?modules.define("jspath",function(t){t(s)}):"function"==typeof define?define("external/jspath/lib/jspath",["require","exports","module"],function(t,e,n){n.exports=s}):JSPath=s}(),define("cloud/cloudUI",["require","external/jspath/lib/jspath"],function(t){function e(t,e,n){return function(){return t=-t,0>t?e:n}}function n(t,e){if(0===e.length)return!0;var n=0;$(window).off("resize.bwTagCloud").on("resize.bwTagCloud",function(){clearTimeout(n),n=setTimeout(function(){r(t,e)},150)}),t.off("click.bwTagCloud").on("click.bwTagCloud",".b-cloud__word",function(){var n=a("^ {.id === $id}",e,{id:this.getAttribute("data-id")});return n&&n[0]?void t.trigger("cloud:displayWordStats",{label:n[0].label,positive:n[0].sentiment.positive||0,negative:n[0].sentiment.negative||0,neutral:n[0].sentiment.neutral||0}):!0}),r(t,e)}function r(t,n){t.addClass("b-cloud").empty().find(".b-stats").addClass("b-stats_empty");var r=t.outerWidth(),a=e(1,"appendTo","prependTo"),i=function(){return $("<div></div>").data("add",e(1,"appendTo","prependTo")).addClass("b-cloud__row")[a()](t)},o=function(t){return $("<div></div>").addClass("b-cloud__word "+(""!==t.modifier?"b-cloud__word_"+t.modifier:"")).text(t.label).attr({title:t.popularity,"data-id":t.id}).css({fontSize:100+60*t.fontWeight+"%"})},u=function(t,e){var n=t.clone(!0);n[e.data("add")()](e),e.data("add")();var a=e.outerWidth();return n.remove(),r>=a},s=i(),l=s;n.forEach(function(t){var e=o(t);if(!u(e,s)){!u(e,s)&&s.find(".b-cloud__word").length>0&&(l=s,s=i())}e[s.data("add")()](s),e.data("outerWidth",e.outerWidth())})}var a=t("external/jspath/lib/jspath");return{init:n}}),define("stats/statsUI",[],function(){function t(t){t.addClass("b-stats b-stats_empty"),$(document).off("cloud:displayWordStats").on("cloud:displayWordStats",function(e,n){t.removeClass("b-stats_empty"),t.find(".b-stats__word").text(n.label),t.find(".b-stats__positive").text(n.positive||0),t.find(".b-stats__negative").text(n.negative||0),t.find(".b-stats__neutral").text(n.neutral||0),t.find(".b-stats__total").text(["positive","negative","neutral"].reduce(function(t,e){return t+=n[e]||0},0))})}return{init:t}}),define("tests/tests",["require","cloud/cloudCtrl","cloud/cloudUI","stats/statsUI"],function(t){function e(t){var e=null;QUnit.test("Test data model",function(r){e=n.getData(t.topics,"burst"),r.equal(typeof e,"object","Created as Object");var a=n.getData(e,"burst");r.equal(typeof a,"object","Model can be created from a model"),r.notStrictEqual(e,a,"New model is not the old one"),r.equal(e.length,a.length,"Model lengths remain equal"),r.equal(e[0].label,"Mixes","First word comes up correctly in the 1st model"),r.strictEqual(e[0].label,a[0].label,"Same for the 2nd"),r.deepEqual(n.getMinMax(e),{min:0,max:60},"Min & max found correctly")}),QUnit.test("Cloud UI",function(t){var n=i.find(".b-cloud");r.init(n,e),t.equal(i.find(".b-cloud").length,1,"Cloud block created"),r.init(n,e),r.init(n,e),r.init(n,e),r.init(n,e),t.equal(i.find(".b-cloud").length,1,"Block can be created many times on the same mode"),t.equal(i.find(".b-cloud__word").length,e.length,"All words are rendered");var a=null;i.on("cloud:displayWordStats",function(e,n){t.equal(n.label,a,"OnClick data is broadcast properly")});var o=i.find(".b-cloud__word").eq(5);a=o.text(),o.click()}),QUnit.test("Stats UI",function(t){var n=i.find(".b-stats");a.init(n),t.equal(i.find(".b-stats").length,1,"Stats block created"),a.init(n,e),a.init(n,e),a.init(n,e),a.init(n,e),t.equal(i.find(".b-stats").length,1,"Block can be created many times on the same mode"),t.equal(i.find(".b-stats").hasClass("b-stats_empty"),!0,"Block content is initially hidden"),i.trigger("cloud:displayWordStats",{label:"Test",positive:42,negative:1,neutral:100500}),t.equal(n.find(".b-stats__word").text(),"Test","Label is set correctly"),t.equal(n.find(".b-stats__positive").text(),"42","Positive is set correctly"),t.equal(n.find(".b-stats__negative").text(),"1","Negative is set correctly"),t.equal(n.find(".b-stats__neutral").text(),"100500","Neutral is set correctly")})}var n=t("cloud/cloudCtrl"),r=t("cloud/cloudUI"),a=t("stats/statsUI"),i=$("#qunit-fixture");$.ajax({url:"data/stats.json",dataType:"json"}).done(e)}),requirejs(["tests/tests"]),define("../bwtests",function(){});