!function(){function r(r){return Function("data,subst",e(t(r)))}var n={PATH:1,SELECTOR:2,OBJ_PRED:3,POS_PRED:4,LOGICAL_EXPR:5,COMPARISON_EXPR:6,MATH_EXPR:7,CONCAT_EXPR:8,UNARY_EXPR:9,POS_EXPR:10,LITERAL:11},t=function(){function r(r){D=r.split(""),M=0,$=null,B=D.length;var n=t(),e=S();return e.type!==G.EOP&&k(e),n}function t(){for(var r,t=e();A("|");)S(),(r||(r=[t])).push(e());return r?{type:n.CONCAT_EXPR,args:r}:t}function e(){return A("(")?u():i()}function u(){L("(");var r=t();L(")");for(var e,u=[];e=o();)u.push(e);return u.length?r.type===n.PATH?(r.parts=r.parts.concat(u),r):(u.unshift(r),{type:n.PATH,parts:u}):r}function o(){return A("[")?p():A("{")?f():A("(")?u():void 0}function i(){d()||k(S());var r,t=!1;A("^")?(S(),t=!0):C()&&(r=S().val.substr(1));for(var e,u=[];e=a();)u.push(e);return{type:n.PATH,fromRoot:t,subst:r,parts:u}}function a(){return T()?s():o()}function s(){var r,t=S().val,e=_();return(A("*")||e.type===G.ID||e.type===G.STR)&&(r=S().val),{type:n.SELECTOR,selector:t,prop:r}}function p(){L("[");var r=P();return L("]"),{type:n.POS_PRED,arg:r}}function f(){L("{");var r=c();return L("}"),{type:n.OBJ_PRED,arg:r}}function c(){for(var r,t=l();A("||");)S(),(r||(r=[t])).push(l());return r?{type:n.LOGICAL_EXPR,op:"||",args:r}:t}function l(){for(var r,t=h();A("&&");)S(),(r||(r=[t])).push(h());return r?{type:n.LOGICAL_EXPR,op:"&&",args:r}:t}function h(){for(var r=v();A("==")||A("!=")||A("===")||A("!==")||A("^=")||A("^==")||A("$==")||A("$=")||A("*==")||A("*=");)r={type:n.COMPARISON_EXPR,op:S().val,args:[r,h()]};return r}function v(){for(var r=g();A("<")||A(">")||A("<=")||A(">=");)r={type:n.COMPARISON_EXPR,op:S().val,args:[r,v()]};return r}function g(){for(var r=y();A("+")||A("-");)r={type:n.MATH_EXPR,op:S().val,args:[r,g()]};return r}function y(){for(var r=O();A("*")||A("/")||A("%");)r={type:n.MATH_EXPR,op:S().val,args:[r,y()]};return r}function P(){if(A(":"))return S(),{type:n.POS_EXPR,toIdx:O()};var r=O();return A(":")?(S(),A("]")?{type:n.POS_EXPR,fromIdx:r}:{type:n.POS_EXPR,fromIdx:r,toIdx:O()}):{type:n.POS_EXPR,idx:r}}function O(){return A("!")||A("-")?{type:n.UNARY_EXPR,op:S().val,arg:O()}:E()}function E(){var r=_(),t=r.type;return t===G.STR||t===G.NUM||t===G.BOOL?{type:n.LITERAL,val:S().val}:d()?i():A("(")?R():k(S())}function R(){L("(");var r=c();return L(")"),r}function A(r){var n=_();return n.type===G.PUNCT&&n.val===r}function d(){return T()||C()||A("^")}function T(){var r=_();if(r.type===G.PUNCT){var n=r.val;return"."===n||".."===n}return!1}function C(){var r=_();return r.type===G.ID&&"$"===r.val[0]}function L(r){var n=S();(n.type!==G.PUNCT||n.val!==r)&&k(n)}function _(){if(null!==$)return $;var r=M;return $=b(),M=r,$}function b(){for(;N(D[M]);)++M;if(M>=B)return{type:G.EOP,range:[M,M]};var r=m();return r||(r=w())||(r=j())||(r=U())?r:(r={range:[M,M]},M>=B?r.type=G.EOP:r.val=D[M],void k(r))}function S(){var r;return $?(M=$.range[1],r=$,$=null,r):b()}function I(r){return"0123456789".indexOf(r)>=0}function N(r){return" "===r}function x(r){return"$"===r||"_"===r||r>="a"&&"z">=r||r>="A"&&"Z">=r}function X(r){return x(r)||r>="0"&&"9">=r}function w(){var r=D[M];if(x(r)){for(var n=M,t=r;++M<B&&(r=D[M],X(r));)t+=r;return"true"===t||"false"===t?{type:G.BOOL,val:"true"===t,range:[n,M]}:{type:G.ID,val:t,range:[n,M]}}}function j(){if('"'===D[M]){for(var r,n=++M,t="",e=!1;B>M;){if(r=D[M++],"\\"===r)r=D[M++];else if('"'===r){e=!0;break}t+=r}return e?{type:G.STR,val:t,range:[n,M]}:void 0}}function U(){var r=M,n=D[M],t="."===n;if(t||I(n)){for(var e=n;++M<B;){if(n=D[M],"."===n){if(t)return;t=!0}else if(!I(n))break;e+=n}return{type:G.NUM,val:t?parseFloat(e):parseInt(e,10),range:[r,M]}}}function m(){var r=M,n=D[M],t=D[M+1];if("."===n){if(I(t))return;return"."===D[++M]?{type:G.PUNCT,val:"..",range:[r,++M]}:{type:G.PUNCT,val:".",range:[r,M]}}if("="===t){var e=D[M+2];if("="===e){if("=!^$*".indexOf(n)>=0)return{type:G.PUNCT,val:n+t+e,range:[r,M+=3]}}else if("=!^$*><".indexOf(n)>=0)return{type:G.PUNCT,val:n+t,range:[r,M+=2]}}return n!==t||"|"!==n&&"&"!==n?":{}()[]^+-*/%!><|".indexOf(n)>=0?{type:G.PUNCT,val:n,range:[r,++M]}:void 0:{type:G.PUNCT,val:n+t,range:[r,M+=2]}}function k(r){r.type===G.EOP&&H(r,z.UNEXP_EOP),H(r,z.UNEXP_TOKEN,r.val)}function H(r,n){var t=Array.prototype.slice.call(arguments,2),e=n.replace(/%(\d)/g,function(r,n){return t[n]||""}),u=new Error(e);throw u.column=r.range[0],u}var D,M,$,B,G={ID:1,NUM:2,STR:3,BOOL:4,PUNCT:5,EOP:6},z={UNEXP_TOKEN:'Unexpected token "%0"',UNEXP_EOP:"Unexpected end of path"};return r}(),e=function(){function r(){if(C.length)return C.shift();var r="v"+ ++T;return d.push(r),r}function t(){for(var r=arguments,n=r.length;n--;)C.push(r[n])}function e(r){if(A=[],d=["res"],T=0,C=[],p(r,"res","data"),A.unshift("var ",Array.isArray?"isArr = Array.isArray":'toStr = Object.prototype.toString, isArr = function(o) { return toStr.call(o) === "[object Array]"; }',",",d.join(","),";"),r.type===n.PATH){var t=r.parts[r.parts.length-1];t&&t.type===n.POS_PRED&&"idx"in t.arg&&A.push("res = res[0];")}return A.push("return res;"),A.join("")}function u(r,t,e){var u=r.parts,p=0,f=u.length;for(A.push(t,"=",r.fromRoot?"data":r.subst?"subst."+r.subst:e,";","isArr("+t+") || ("+t+" = ["+t+"]);");f>p;){var c=u[p++];switch(c.type){case n.SELECTOR:".."===c.selector?i(c,t,t):o(c,t,t);break;case n.OBJ_PRED:a(c,t,t);break;case n.POS_PRED:s(c,t,t);break;case n.CONCAT_EXPR:g(c,t,t)}}}function o(n,e,u){if(n.prop){var o=y(n.prop),i=r(),a=r(),s=r(),p=r(),f=r(),c=r(),l=r();A.push(i,"= [];",a,"= 0;",s,"=",u,".length;",l,"= [];","while(",a,"<",s,") {",p,"=",u,"[",a,"++];","if(",p,"!= null) {"),"*"===n.prop?(A.push("if(typeof ",p,'=== "object") {',"if(isArr(",p,")) {",i,"=",i,".concat(",p,");","}","else {","for(",f," in ",p,") {","if(",p,".hasOwnProperty(",f,")) {",c,"=",p,"[",f,"];"),P(i,c),A.push("}","}","}","}")):(A.push(c,"=",p,"[",o,"];"),P(i,c,l,s)),A.push("}","}",e,"=",s,"> 1 &&",l,".length?",l,".length > 1?",i,".concat.apply(",i,",",l,") :",i,".concat(",l,"[0]) :",i,";"),t(i,a,s,p,f,c,l)}}function i(n,e,u){var o=n.prop,i=r(),a=r(),s=r(),p=r(),f=r(),c=r(),l=r(),h=r();A.push(i,"=",u,".slice(),",h,"= [];","while(",i,".length) {",a,"=",i,".shift();"),o?A.push("if(typeof ",a,'=== "object" &&',a,") {"):A.push("if(typeof ",a,"!= null) {"),A.push(s,"= [];","if(isArr(",a,")) {",p,"= 0,",l,"=",a,".length;","while(",p,"<",l,") {",c,"=",a,"[",p,"++];"),o&&A.push("if(typeof ",c,'=== "object") {'),P(s,c),o&&A.push("}"),A.push("}","}","else {"),o?"*"!==o&&(A.push(c,"=",a,'["'+o+'"];'),P(h,c)):(P(h,a),A.push("if(typeof ",a,'=== "object") {')),A.push("for(",f," in ",a,") {","if(",a,".hasOwnProperty(",f,")) {",c,"=",a,"[",f,"];"),P(s,c),"*"===o&&P(h,c),A.push("}","}"),o||A.push("}"),A.push("}",s,".length &&",i,".unshift.apply(",i,",",s,");","}","}",e,"=",h,";"),t(i,a,s,p,f,c,l,h)}function a(n,e,u){var o=r(),i=r(),a=r(),s=r(),f=r();A.push(o,"= [];",i,"= 0;",a,"=",u,".length;","while(",i,"<",a,") {",f,"=",u,"[",i,"++];"),p(n.arg,s,f),A.push(E(n.arg,s),"&&",o,".push(",f,");","}",e,"=",o,";"),t(o,i,a,f,s)}function s(n,e,u){var o,i,a=n.arg;if(a.idx){var s=r();return p(a.idx,s,u),A.push(s,"< 0 && (",s,"=",u,".length +",s,");",e,"=",u,"[",s,"] == null? [] : [",u,"[",s,"]];"),t(s),!1}a.fromIdx?a.toIdx?(p(a.fromIdx,o=r(),u),p(a.toIdx,i=r(),u),A.push(e,"=",u,".slice(",o,",",i,");"),t(o,i)):(p(a.fromIdx,o=r(),u),A.push(e,"=",u,".slice(",o,");"),t(o)):(p(a.toIdx,i=r(),u),A.push(e,"=",u,".slice(0,",i,");"),t(i))}function p(r,t,e){switch(r.type){case n.PATH:u(r,t,e);break;case n.CONCAT_EXPR:g(r,t,e);break;case n.COMPARISON_EXPR:f(r,t,e);break;case n.MATH_EXPR:h(r,t,e);break;case n.LOGICAL_EXPR:l(r,t,e);break;case n.UNARY_EXPR:v(r,t,e);break;case n.LITERAL:var o=r.val;A.push(t,"=","string"==typeof o?y(o):o,";")}}function f(e,u,o){var i=r(),a=r(),s=r(),f=r(),l=r(),h=r(),v=r(),g=r(),y=e.args[0],P=e.args[1];A.push(u,"= false;"),p(y,i,o),p(P,a,o);var O=y.type===n.PATH,E=P.type===n.LITERAL;A.push(s,"="),O?A.push("true;"):A.push("isArr(",i,");"),A.push(f,"="),E?A.push("false;"):A.push("isArr(",a,");"),A.push("if("),O||A.push(s,"&&"),A.push(i,".length === 1) {",i,"=",i,"[0];",s,"= false;","}"),E||A.push("if(",f,"&&",a,".length === 1) {",a,"=",a,"[0];",f,"= false;","}"),A.push(l,"= 0;","if(",s,") {",v,"=",i,".length;"),E||(A.push("if(",f,") {",g,"=",a,".length;","while(",l,"<",v,"&& !",u,") {",h,"= 0;","while(",h,"<",g,") {"),c(e.op,[i,"[",l,"]"].join(""),[a,"[",h,"]"].join("")),A.push(u,"= true;","break;","}","++",h,";","}","++",l,";","}","}","else {")),A.push("while(",l,"<",v,") {"),c(e.op,[i,"[",l,"]"].join(""),a),A.push(u,"= true;","break;","}","++",l,";","}"),E||A.push("}"),A.push("}"),E||(A.push("else if(",f,") {",g,"=",a,".length;","while(",l,"<",g,") {"),c(e.op,i,[a,"[",l,"]"].join("")),A.push(u,"= true;","break;","}","++",l,";","}","}")),A.push("else {",u,"=",L[e.op](i,a),";","}"),t(i,a,s,f,l,h,v,g)}function c(r,n,t){A.push("if(",L[r](n,t),") {")}function l(n,e,u){var o,i=[],a=n.args,s=a.length,f=0;switch(A.push(e,"= false;"),n.op){case"&&":for(;s>f;)i.push(o=r()),p(a[f],o,u),A.push("if(",E(a[f++],o),") {");A.push(e,"= true;");break;case"||":for(;s>f;)i.push(o=r()),p(a[f],o,u),A.push("if(",E(a[f],o),") {",e,"= true;","}"),f++ +1<s&&A.push("else {");--s}for(;s--;)A.push("}");t.apply(null,i)}function h(n,e,u){var o=r(),i=r(),a=n.args;p(a[0],o,u),p(a[1],i,u),A.push(e,"=",L[n.op](R(a[0],o),R(a[1],i)),";"),t(o,i)}function v(n,e,u){var o=r(),i=n.arg;switch(p(i,o,u),n.op){case"!":A.push(e,"= !",E(i,o)+";");break;case"-":A.push(e,"= -",R(i,o)+";")}t(o)}function g(n,e,u){for(var o=[],i=n.args,a=i.length,s=0;a>s;)o.push(r()),p(i[s],o[s++],u);A.push(e,"= (",e,"= []).concat.call(",e,",",o.join(","),");"),t.apply(null,o)}function y(r){return"'"+r.replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"}function P(r,n,t,e){A.push("if(",n,"!= null) {","if(isArr(",n,")) {"),t&&(A.push(e,"> 1?"),O(t,n),A.push(":")),A.push(r,"=",r,".length? ",r,".concat(",n,") : ",n,";","}","else {"),t&&A.push("if(",t,".length) {",r,"=",r,".concat.apply(",r,",",t,");",t,"= [];","}"),O(r,n),A.push(";","}","}")}function O(r,n){A.push(r,".length?",r,".push(",n,") :",r,"[0] =",n)}function E(r,t){switch(r.type){case n.LOGICAL_EXPR:return t;case n.LITERAL:return"!!"+t;case n.PATH:return t+".length > 0";default:return["(typeof ",t,'=== "boolean"?',t,":","isArr(",t,")?",t,".length > 0 : !!",t,")"].join("")}}function R(r,t){switch(r.type){case n.LITERAL:return t;case n.PATH:return t+"[0]";default:return["(isArr(",t,")?",t,"[0] : ",t,")"].join("")}}var A,d,T,C,L={"===":function(r,n){return r+"==="+n},"==":function(r,n){return["typeof ",r,'=== "string" && typeof ',n,'=== "string"?',r,".toLowerCase() ===",n,".toLowerCase() :"+r,"==",n].join("")},">=":function(r,n){return r+">="+n},">":function(r,n){return r+">"+n},"<=":function(r,n){return r+"<="+n},"<":function(r,n){return r+"<"+n},"!==":function(r,n){return r+"!=="+n},"!=":function(r,n){return r+"!="+n},"^==":function(r,n){return["typeof ",r,'=== "string" && typeof ',n,'=== "string" &&',r,".indexOf(",n,") === 0"].join("")},"^=":function(r,n){return[r,"!= null &&",n,"!= null &&",r,".toString().toLowerCase().indexOf(",n,".toString().toLowerCase()) === 0"].join("")},"$==":function(r,n){return["typeof ",r,'=== "string" && typeof ',n,'=== "string" &&',r,".lastIndexOf(",n,") ===",r,".length -",n,".length"].join("")},"$=":function(r,n){return[r,"!= null &&",n,"!= null &&","(",r,"=",r,".toLowerCase().toString()).indexOf(","(",n,"=",n,".toLowerCase().toLowerCase())) ===",r,".length -",n,".length"].join("")},"*==":function(r,n){return["typeof ",r,'=== "string" && typeof ',n,'=== "string" &&',r,".indexOf(",n,") > -1"].join("")},"*=":function(r,n){return[r,"!= null && ",n,"!= null &&",r,".toString().toLowerCase().indexOf(",n,".toString().toLowerCase()) > -1"].join("")},"+":function(r,n){return r+"+"+n},"-":function(r,n){return r+"-"+n},"*":function(r,n){return r+"*"+n},"/":function(r,n){return r+"/"+n},"%":function(r,n){return r+"%"+n}};return e}(),u={},o=[],i={cacheSize:100},a={cacheSize:function(r,n){if(r>n&&o.length>n)for(var t=o.splice(0,o.length-n),e=t.length;e--;)delete u[t[e]]}},s=function(n,t,e){return u[n]||(u[n]=r(n),o.push(n)>i.cacheSize&&delete u[o.shift()]),u[n](t,e||{})};s.version="0.3.0",s.params=function(r){if(!arguments.length)return i;for(var n in r)r.hasOwnProperty(n)&&(a[n]&&a[n](i[n],r[n]),i[n]=r[n])},s.compile=r,s.apply=s,"object"==typeof module&&"object"==typeof module.exports?module.exports=s:"object"==typeof modules?modules.define("jspath",function(r){r(s)}):"function"==typeof define?define(function(r,n,t){t.exports=s}):JSPath=s}();